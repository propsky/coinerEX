# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 專案概述

這是一個兌幣機管理系統專案，整合了硬體兌幣機、IPC控制器與雲端管理平台。

### 系統架構

- **硬體層**: 
  - 飛絡力兌幣機設備（約100台）
  - Nano Pi M1plus 主板運行 Debian 系統
  - 使用 Python 介面進行硬體控制
  - 透過 MQTT 協定上傳設備資料

- **通訊層**:
  - 擎天有限公司 IPC 網路連接
  - MQTT 訊息傳輸協定
  - 原本使用 LINE OA 帳號登入（LINE Frontend LIFF 架構）
  - 計劃遷移至 Telegram 推播系統（降低成本）

- **應用層**:
  - IOTCoinChanger 管理介面
  - 機台狀態監控
  - 遠端補幣功能
  - 出幣紀錄查詢
  - 系統設定管理

### 主要功能模組

1. **機台狀態管理**
   - 即時狀態顯示
   - 故障通知推播
   - 設備參數設定

2. **出幣系統**
   - 兌幣交易紀錄
   - 遠端補幣操作
   - 兌幣通知推播

3. **用戶管理**
   - LINE LIFF 登入整合
   - 擎天管理帳號服務

### 推播系統規劃

- **訊息類型**: 故障通訊、兌幣通知
- **訊息量評估**: 每台每月約1000個訊息
- **成本考量**: 從 LINE Message API (800元/3000訊息) 遷移至 Telegram

### 開發注意事項

- 需考慮舊系統 UI 相容性
- 資料庫設計需支援 MQTT 資料格式
- 硬體設定介面需要使用者友善設計
- 網路參數設定需要簡化流程

### 系統費用結構

- 原系統升級費: 399元含運
- 年費: 600元/台
- 功能包含: 機台即時狀況查詢、歷史記錄查詢、遠端補幣功能

## 開發環境

### 文件結構
- `01-專案文件/` - 專案規劃與系統說明文件
- `02-業務分析/` - 需求分析與業務流程
- `03-技術規劃/` - 技術架構與實作規劃
- `04-開發文件/` - 開發指南與API文件
- `05-原始資料/` - 原始資料與參考文件
- `docs/` - MkDocs文件網站

### 技術棧
- **前端**: HTML/CSS/JavaScript (考慮使用現有UI架構)
- **後端**: Python FastAPI (RESTful API框架)
- **資料庫**: MySQL 8.0+ (支援JSON資料格式)
- **訊息互動**: LINE Bot API (對話查詢功能)
- **硬體通訊**: MQTT協定
- **部署**: Linode雲端服務

### 開發優先級
1. 系統升級轉移流程 (最高優先級)
2. LINE Bot對話互動系統整合
3. 雲端管理平台功能
4. 硬體IPC程式更新
5. 使用者介面優化

## 編碼規範

- 使用繁體中文註解和文件
- 保持與現有系統的相容性
- 優先考慮系統穩定性與可靠性
- 遵循硬體控制的安全性要求

## 開發環境限制

- 不要使用 `tree` 指令查看目錄結構
- 使用 `find`、`ls` 或其他方式來檢視檔案結構
- 在需要顯示目錄結構時，使用 `find . -type d` 和 `ls -la` 組合